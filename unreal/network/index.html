<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Unreal Network | Niiok's Blog</title>
<meta name=keywords content>
<meta name=description content="Intro  Unreal network system is based on Server-Client model. If developers consider about &ldquo;Replication&rdquo;, game can support both singleplayer and multiplayer. UE4 Clients can not communicate without Server (p2p is not currently supported)  Struct Network Mode  ENetMode  NM_Standalone  Authoritative : true Listening : false LocalPlayer : true   NM_DedicatedServer  Authoritative : true Listening : true LocalPlayer : false   NM_ListenServer  Authoritative : true Listening : true LocalPlayer : true   NM_Client  Authoritative : false Listening : false LocalPlayer : true   NM_MAX    Role, RemoteRole  ENetRole  ROLE_None  not related with replication   ROLE_SimulatedProxy  copy of ROLE_Authority extrapolative-predicted with server values   ROLE_AutonomousProxy  copy of ROLE_Authority extrapolative-predicted with server values + local functions (e.">
<meta name=author content="Niiok">
<link rel=canonical href=https://niiok.github.io/unreal/network/>
<meta name=google-site-verification content="DdPXi9zFzhddjnm20EWbhWv7tBvTySWZYj82E4eWwVA">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://niiok.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://niiok.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://niiok.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://niiok.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://niiok.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Unreal Network">
<meta property="og:description" content="Intro  Unreal network system is based on Server-Client model. If developers consider about &ldquo;Replication&rdquo;, game can support both singleplayer and multiplayer. UE4 Clients can not communicate without Server (p2p is not currently supported)  Struct Network Mode  ENetMode  NM_Standalone  Authoritative : true Listening : false LocalPlayer : true   NM_DedicatedServer  Authoritative : true Listening : true LocalPlayer : false   NM_ListenServer  Authoritative : true Listening : true LocalPlayer : true   NM_Client  Authoritative : false Listening : false LocalPlayer : true   NM_MAX    Role, RemoteRole  ENetRole  ROLE_None  not related with replication   ROLE_SimulatedProxy  copy of ROLE_Authority extrapolative-predicted with server values   ROLE_AutonomousProxy  copy of ROLE_Authority extrapolative-predicted with server values + local functions (e.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://niiok.github.io/unreal/network/"><meta property="article:section" content="unreal">
<meta property="article:published_time" content="2022-05-17T00:00:00+00:00">
<meta property="article:modified_time" content="2022-05-17T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Unreal Network">
<meta name=twitter:description content="Intro  Unreal network system is based on Server-Client model. If developers consider about &ldquo;Replication&rdquo;, game can support both singleplayer and multiplayer. UE4 Clients can not communicate without Server (p2p is not currently supported)  Struct Network Mode  ENetMode  NM_Standalone  Authoritative : true Listening : false LocalPlayer : true   NM_DedicatedServer  Authoritative : true Listening : true LocalPlayer : false   NM_ListenServer  Authoritative : true Listening : true LocalPlayer : true   NM_Client  Authoritative : false Listening : false LocalPlayer : true   NM_MAX    Role, RemoteRole  ENetRole  ROLE_None  not related with replication   ROLE_SimulatedProxy  copy of ROLE_Authority extrapolative-predicted with server values   ROLE_AutonomousProxy  copy of ROLE_Authority extrapolative-predicted with server values + local functions (e.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Unreals","item":"https://niiok.github.io/unreal/"},{"@type":"ListItem","position":2,"name":"Unreal Network","item":"https://niiok.github.io/unreal/network/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Unreal Network","name":"Unreal Network","description":"Intro  Unreal network system is based on Server-Client model. If developers consider about \u0026ldquo;Replication\u0026rdquo;, game can support both singleplayer and multiplayer. UE4 Clients can not communicate without Server (p2p is not currently supported)  Struct Network Mode  ENetMode  NM_Standalone  Authoritative : true Listening : false LocalPlayer : true   NM_DedicatedServer  Authoritative : true Listening : true LocalPlayer : false   NM_ListenServer  Authoritative : true Listening : true LocalPlayer : true   NM_Client  Authoritative : false Listening : false LocalPlayer : true   NM_MAX    Role, RemoteRole  ENetRole  ROLE_None  not related with replication   ROLE_SimulatedProxy  copy of ROLE_Authority extrapolative-predicted with server values   ROLE_AutonomousProxy  copy of ROLE_Authority extrapolative-predicted with server values + local functions (e.","keywords":[],"articleBody":"Intro  Unreal network system is based on Server-Client model. If developers consider about “Replication”, game can support both singleplayer and multiplayer. UE4 Clients can not communicate without Server (p2p is not currently supported)  Struct Network Mode  ENetMode  NM_Standalone  Authoritative : true Listening : false LocalPlayer : true   NM_DedicatedServer  Authoritative : true Listening : true LocalPlayer : false   NM_ListenServer  Authoritative : true Listening : true LocalPlayer : true   NM_Client  Authoritative : false Listening : false LocalPlayer : true   NM_MAX    Role, RemoteRole  ENetRole  ROLE_None  not related with replication   ROLE_SimulatedProxy  copy of ROLE_Authority extrapolative-predicted with server values   ROLE_AutonomousProxy  copy of ROLE_Authority extrapolative-predicted with server values + local functions (e.g. player input) currently, only for possessed actor with ownership   ROLE_Authority  origin not available for NM_Client currently   ROLE_MAX    Ownership  PlayerController is root of ownership  Pawn that possessed by PlayerController and Actors owned by the Pawn is owned by the Player Subobjects owned by its outer’s owner   needed for  Client RPC destination replication relevancy  bOnlyRelevantToOwner   conditional property replication  COND_OwnerOnly, COND_InitialOrOwner, COND_SkipOwner   ROLE_AutonomousProxy to ROLE_SimulatedProxy  ROLE_AutonomousProxy is only allowed for owner client      Method Property Replication 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  class ENGINE_API AActor : public UObject { UPROPERTY( Replicated ) // originally, it's ReplicatedWith specifier  AActor * Owner; UPROPERTY(EditDefaultsOnly, ReplicatedUsing=OnRep_ReplicatedMovement, Category=Replication, AdvancedDisplay) struct FRepMovement ReplicatedMovement; UFUNCTION() virtual void OnRep_ReplicatedMovement(); }; void AActor::GetLifetimeReplicatedProps( TArray FLifetimeProperty  \u0026 OutLifetimeProps ) const { DOREPLIFETIME( AActor, Owner ); DOREPLIFETIME_CONDITION( AActor, ReplicatedMovement, COND_SimulatedOnly ); // check \"UnrealNetwork.h\" for more variations } void AActor::PreReplication( IRepChangedPropertyTracker \u0026 ChangedPropertyTracker ) { DOREPLIFETIME_ACTIVE_OVERRIDE( AActor, ReplicatedMovement, bReplicateMovement ); } void AActor::OnRep_ReplicatedMovement() { ... }    server to client only reliable ELifetimeCondition  COND_None COND_InitialOnly COND_OwnerOnly COND_SkipOwner COND_SimulatedOnly COND_AutonomousOnly COND_SimulatedOrPhysics COND_InitialOrOwner COND_Custom + SetCustonIsActiveOverride(...) COND_ReplayOrOwner COND_ReplayOnly COND_SimulatedOnlyNoReplay COND_SimulatedOrPhysicsNoReplay COND_SkipReplay COND_Never COND_Max   NetUpdateFrequency  and MinNetUpdateFrequency for Adaptive Network Frequency   with UPROPERTY(replicated), UObject references are replicated via FNetworkGUID  check with UObject::IsSupportedForNetwork() refernce replication occurs in one of them :  replicated actor stably named actor replicated component stably named component UObject from loaded package   “stably named” means  existing in both server and client with exactly same name actors from package are stably named (not spawned during gameplay) components under are stably named  from package added with construction script (static component) manually marked (via UActorComponent::SetNetAddressable(...))  need same name          Remote Procedure Call (RPC) 1 2 3 4 5 6 7 8 9 10 11 12 13  UFUNCTION(Server, WithValidation) void FunctionThatCalledOnServer(); UFUNCTION(Client, Reliable) void FunctionThatCalledOnOwnerClient(); UFUNCTION(NetMulticast) void FunctionThatCalledOnEveryActor(); void ClassName::FunctionThatCalledOnServer_Implementation() {} bool ClassName::FunctionThatCalledOnServer_Validation() {return true;} void ClassName::FunctionThatCalledOnOwnerClient_Implementation() {} void ClassName::FunctionThatCalledOnEveryActor_Implementation() {}    Only executed on Actor that is replicating If you want to make sure RPC executed. you should set Reliable specifier on RPC’s UFUNCTION().  RPC is Unreiiable by default. If you spam Reliable like every ticks, client may get disconnected due to preventation of DDOS.   WithValidation specifier declares _Validation function with bool return and same parameters.  _Validation function must be followed after WithValidation specifier. disconnect client if return is false execute RPC if return is true Server RPC requires WithValidation   when calling RPC on Server    actor \\ specifier none NetMulticast Server Client     Owned by client server server \u0026 all clients server owning client   Owned by server server server \u0026 all clients server server   Unowned server server \u0026 all clients server server     when calling RPC on Client    actor \\ specifier none NetMulticast Server Client     Owned by self self self server self   Owned by other self self none self   Owned by server self self none self   Unowned self self none self      Component Replication  tbd  Optimization Relevancy  AActor::IsNetRelevantFor()  return true : bIsAlwaysRelevant | Owned | Pawn | Instigated by Pawn return owner’s : bNetUseOwnerRelevancy \u0026 Owned return false : bOnlyRelevantToOwner \u0026 not 1. return base’s : attached to skeleton of another actor return false : bHidden \u0026 root component not collide  warning if there is no root component   return ture : distance based relevancy (AGameNetworkManager) \u0026 closer than net cull distance   Pawn and PlayerController return different result (overriding) bStatic Actors can also be replicated imperfect  large actor sound occlusion of ambient sound though, packet loss is more critical so it’s affordable    Priority  NetPriority weight for bandwidth load balancing default values  Actor = 1.0 Matinee = 2.7 Pawn = 3.0 PlayerController = 3.0   AActor::GetNetPriority() = NetPriority * replication waiting time (plus location and distance, etc)  Dormancy  ENetDormancy  DORM_Never DORM_Awake DORM_DormantAll DORM_DormantPartial + GetNetDormancy() DORM_Initial DORM_Max    NetClientTicksPerSecond  tbd  Replication Graph  tbd  Conceptual Tips  reduce bReplicates reduce NetUpdateFrequency use Dormancy use Relevancy reduce NetClientTicksPerSecond use Quantizing (e.g. FVector_NetQuantize) minimize RPC : replace into RepNotify  remove Server RPC that unused on clients reduce NetMulticast RPC reduce FName as RPC parameter don’t spam reliable RPC   check ROLE_Authority for server logic check IsLocallyControlled for owner logic  but not in constructor    Flow UNetDriver::ServerReplicateActors flow  tbd  Character Movement Component flow  tbd  Others Travelling  Seamless (non-blocking)  highly recommended   Non-Seamless (blocking)  first map loading client-to-server first connect ending game, starting new game   UEngine::Browse(...) UWorld::ServerTravel(...) APlayerController::ClientTravel(...) Transition Map  UGameMapSetting::TransitionMap AGameModeBase::bUseSeamlessTravel   Seamless Travel Flow  Mark persistent actors to transition map Travel to transition map Mark persistent actors to final map Travel to final map   Persistent actors  GameMode actor (server only)  Actors added by AGameModeBase::GetSeamlessTravelActorList   Controllers with valid PlayerState (server only) All PlayerControllers (server only) All local PlayerControllers (server and clients)  Actors added by APlayerController::GetSeamlessTravelActorList on local      Online Subsystem  tbd  Session  tbd  Online Beacons  tbd  Practical Network Profiler  tbd  Testing Multiplay  tbd  ","wordCount":"890","inLanguage":"en","datePublished":"2022-05-17T00:00:00Z","dateModified":"2022-05-17T00:00:00Z","author":{"@type":"Person","name":"Niiok"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://niiok.github.io/unreal/network/"},"publisher":{"@type":"Organization","name":"Niiok's Blog","logo":{"@type":"ImageObject","url":"https://niiok.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://niiok.github.io/ accesskey=h title="Niiok's Blog (Alt + H)">Niiok's Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://niiok.github.io/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://niiok.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://niiok.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://niiok.github.io/unreal/>Unreals</a></div>
<h1 class=post-title>
Unreal Network
</h1>
<div class=post-meta><span title="2022-05-17 00:00:00 +0000 UTC">May 17, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Niiok&nbsp;|&nbsp;<a href=https://github.com/Niiok/niiok.github.io/tree/master/content/unreal/network.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#intro aria-label=Intro>Intro</a></li>
<li>
<a href=#struct aria-label=Struct>Struct</a><ul>
<li>
<a href=#network-mode aria-label="Network Mode">Network Mode</a></li>
<li>
<a href=#role-remoterole aria-label="Role, RemoteRole">Role, RemoteRole</a></li>
<li>
<a href=#ownership aria-label=Ownership>Ownership</a></li></ul>
</li>
<li>
<a href=#method aria-label=Method>Method</a><ul>
<li>
<a href=#property-replication aria-label="Property Replication">Property Replication</a></li>
<li>
<a href=#remote-procedure-call-rpc aria-label="Remote Procedure Call (RPC)">Remote Procedure Call (RPC)</a></li>
<li>
<a href=#component-replication aria-label="Component Replication"><del>Component Replication</del></a></li></ul>
</li>
<li>
<a href=#optimization aria-label=Optimization>Optimization</a><ul>
<li>
<a href=#relevancy aria-label=Relevancy>Relevancy</a></li>
<li>
<a href=#priority aria-label=Priority>Priority</a></li>
<li>
<a href=#dormancy aria-label=Dormancy>Dormancy</a></li>
<li>
<a href=#netclienttickspersecond aria-label=NetClientTicksPerSecond><del>NetClientTicksPerSecond</del></a></li>
<li>
<a href=#replication-graph aria-label="Replication Graph"><del>Replication Graph</del></a></li>
<li>
<a href=#conceptual-tips aria-label="Conceptual Tips">Conceptual Tips</a></li></ul>
</li>
<li>
<a href=#flow aria-label=Flow>Flow</a><ul>
<li>
<a href=#unetdriverserverreplicateactors-flow aria-label="UNetDriver::ServerReplicateActors flow"><del>UNetDriver::ServerReplicateActors flow</del></a></li>
<li>
<a href=#character-movement-component-flow aria-label="Character Movement Component flow"><del>Character Movement Component flow</del></a></li></ul>
</li>
<li>
<a href=#others aria-label=Others>Others</a><ul>
<li>
<a href=#travelling aria-label=Travelling>Travelling</a></li>
<li>
<a href=#online-subsystem aria-label="Online Subsystem"><del>Online Subsystem</del></a></li>
<li>
<a href=#session aria-label=Session><del>Session</del></a></li>
<li>
<a href=#online-beacons aria-label="Online Beacons"><del>Online Beacons</del></a></li></ul>
</li>
<li>
<a href=#practical aria-label=Practical>Practical</a><ul>
<li>
<a href=#network-profiler aria-label="Network Profiler"><del>Network Profiler</del></a></li>
<li>
<a href=#testing-multiplay aria-label="Testing Multiplay"><del>Testing Multiplay</del></a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=intro>Intro<a hidden class=anchor aria-hidden=true href=#intro>#</a></h1>
<ul>
<li>Unreal network system is based on <a href=https://docs.unrealengine.com/4.27/InteractiveExperiences/Networking/Server/>Server-Client model</a>.</li>
<li>If developers consider about &ldquo;Replication&rdquo;, game can support both singleplayer and multiplayer.</li>
<li>UE4 Clients can not communicate without Server (p2p is not currently supported)</li>
</ul>
<h1 id=struct>Struct<a hidden class=anchor aria-hidden=true href=#struct>#</a></h1>
<h2 id=network-mode>Network Mode<a hidden class=anchor aria-hidden=true href=#network-mode>#</a></h2>
<ul>
<li><code>ENetMode</code>
<ul>
<li><code>NM_Standalone</code>
<ul>
<li>Authoritative : true</li>
<li>Listening : false</li>
<li>LocalPlayer : true</li>
</ul>
</li>
<li><code>NM_DedicatedServer</code>
<ul>
<li>Authoritative : true</li>
<li>Listening : true</li>
<li>LocalPlayer : false</li>
</ul>
</li>
<li><code>NM_ListenServer</code>
<ul>
<li>Authoritative : true</li>
<li>Listening : true</li>
<li>LocalPlayer : true</li>
</ul>
</li>
<li><code>NM_Client</code>
<ul>
<li>Authoritative : false</li>
<li>Listening : false</li>
<li>LocalPlayer : true</li>
</ul>
</li>
<li><del><code>NM_MAX</code></del></li>
</ul>
</li>
</ul>
<h2 id=role-remoterole>Role, RemoteRole<a hidden class=anchor aria-hidden=true href=#role-remoterole>#</a></h2>
<ul>
<li><code>ENetRole</code>
<ul>
<li><code>ROLE_None</code>
<ul>
<li>not related with replication</li>
</ul>
</li>
<li><code>ROLE_SimulatedProxy</code>
<ul>
<li>copy of <code>ROLE_Authority</code></li>
<li>extrapolative-predicted with server values</li>
</ul>
</li>
<li><code>ROLE_AutonomousProxy</code>
<ul>
<li>copy of <code>ROLE_Authority</code></li>
<li>extrapolative-predicted with server values + local functions (e.g. player input)</li>
<li>currently, only for possessed actor with ownership</li>
</ul>
</li>
<li><code>ROLE_Authority</code>
<ul>
<li>origin</li>
<li>not available for <code>NM_Client</code> currently</li>
</ul>
</li>
<li><del><code>ROLE_MAX</code></del></li>
</ul>
</li>
</ul>
<h2 id=ownership>Ownership<a hidden class=anchor aria-hidden=true href=#ownership>#</a></h2>
<ul>
<li>PlayerController is root of ownership
<ul>
<li>Pawn that possessed by PlayerController and Actors owned by the Pawn is owned by the Player</li>
<li>Subobjects owned by its outer&rsquo;s owner</li>
</ul>
</li>
<li>needed for
<ul>
<li>Client RPC destination</li>
<li>replication relevancy
<ul>
<li><code>bOnlyRelevantToOwner</code></li>
</ul>
</li>
<li>conditional property replication
<ul>
<li><code>COND_OwnerOnly</code>, <code>COND_InitialOrOwner</code>, <code>COND_SkipOwner</code></li>
</ul>
</li>
<li><code>ROLE_AutonomousProxy</code> to <code>ROLE_SimulatedProxy</code>
<ul>
<li><code>ROLE_AutonomousProxy</code> is only allowed for owner client</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id=method>Method<a hidden class=anchor aria-hidden=true href=#method>#</a></h1>
<h2 id=property-replication>Property Replication<a hidden class=anchor aria-hidden=true href=#property-replication>#</a></h2>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ENGINE_API</span> AActor : <span style=color:#66d9ef>public</span> UObject
{
    UPROPERTY( Replicated ) <span style=color:#75715e>// originally, it&#39;s ReplicatedWith specifier
</span><span style=color:#75715e></span>    AActor <span style=color:#f92672>*</span> Owner;

    UPROPERTY(EditDefaultsOnly, ReplicatedUsing<span style=color:#f92672>=</span>OnRep_ReplicatedMovement, Category<span style=color:#f92672>=</span>Replication, AdvancedDisplay)
    <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>FRepMovement</span> ReplicatedMovement;

    UFUNCTION()
    <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> OnRep_ReplicatedMovement();
};

<span style=color:#66d9ef>void</span> AActor<span style=color:#f92672>::</span>GetLifetimeReplicatedProps( TArray<span style=color:#f92672>&lt;</span> FLifetimeProperty <span style=color:#f92672>&gt;</span> <span style=color:#f92672>&amp;</span> OutLifetimeProps ) <span style=color:#66d9ef>const</span>
{
    DOREPLIFETIME( AActor, Owner );
    DOREPLIFETIME_CONDITION( AActor, ReplicatedMovement, COND_SimulatedOnly );
	<span style=color:#75715e>// check &#34;UnrealNetwork.h&#34; for more variations
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>void</span> AActor<span style=color:#f92672>::</span>PreReplication( IRepChangedPropertyTracker <span style=color:#f92672>&amp;</span> ChangedPropertyTracker )
{
    DOREPLIFETIME_ACTIVE_OVERRIDE( AActor, ReplicatedMovement, bReplicateMovement );
}

<span style=color:#66d9ef>void</span> AActor<span style=color:#f92672>::</span>OnRep_ReplicatedMovement() { ... }
</code></pre></td></tr></table>
</div>
</div><ul>
<li>server to client only</li>
<li>reliable</li>
<li><code>ELifetimeCondition</code>
<ul>
<li><code>COND_None</code></li>
<li><code>COND_InitialOnly</code></li>
<li><code>COND_OwnerOnly</code></li>
<li><code>COND_SkipOwner</code></li>
<li><code>COND_SimulatedOnly</code></li>
<li><code>COND_AutonomousOnly</code></li>
<li><code>COND_SimulatedOrPhysics</code></li>
<li><code>COND_InitialOrOwner</code></li>
<li><code>COND_Custom</code> + <code>SetCustonIsActiveOverride(...)</code></li>
<li><code>COND_ReplayOrOwner</code></li>
<li><code>COND_ReplayOnly</code></li>
<li><code>COND_SimulatedOnlyNoReplay</code></li>
<li><code>COND_SimulatedOrPhysicsNoReplay</code></li>
<li><code>COND_SkipReplay</code></li>
<li><code>COND_Never</code></li>
<li><del><code>COND_Max</code></del></li>
</ul>
</li>
<li><code>NetUpdateFrequency</code>
<ul>
<li>and <code>MinNetUpdateFrequency</code> for <em>Adaptive Network Frequency</em></li>
</ul>
</li>
<li>with <code>UPROPERTY(replicated)</code>, UObject references are replicated via <code>FNetworkGUID</code>
<ul>
<li>check with <code>UObject::IsSupportedForNetwork()</code></li>
<li>refernce replication occurs in one of them :
<ul>
<li>replicated actor</li>
<li>stably named actor</li>
<li>replicated component</li>
<li>stably named component</li>
<li>UObject from loaded package</li>
</ul>
</li>
<li>&ldquo;stably named&rdquo; means
<ul>
<li>existing in both server and client with exactly same name</li>
<li>actors from package are stably named (not spawned during gameplay)</li>
<li>components under are stably named
<ul>
<li>from package</li>
<li>added with construction script (static component)</li>
<li>manually marked (via <code>UActorComponent::SetNetAddressable(...)</code>)
<ul>
<li>need same name</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id=remote-procedure-call-rpc>Remote Procedure Call (RPC)<a hidden class=anchor aria-hidden=true href=#remote-procedure-call-rpc>#</a></h2>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++>UFUNCTION(Server, WithValidation)
<span style=color:#66d9ef>void</span> FunctionThatCalledOnServer();

UFUNCTION(Client, Reliable)
<span style=color:#66d9ef>void</span> FunctionThatCalledOnOwnerClient();

UFUNCTION(NetMulticast)
<span style=color:#66d9ef>void</span> FunctionThatCalledOnEveryActor();

<span style=color:#66d9ef>void</span> ClassName<span style=color:#f92672>::</span>FunctionThatCalledOnServer_Implementation() {}
<span style=color:#66d9ef>bool</span> ClassName<span style=color:#f92672>::</span>FunctionThatCalledOnServer_Validation() {<span style=color:#66d9ef>return</span> true;}
<span style=color:#66d9ef>void</span> ClassName<span style=color:#f92672>::</span>FunctionThatCalledOnOwnerClient_Implementation() {}
<span style=color:#66d9ef>void</span> ClassName<span style=color:#f92672>::</span>FunctionThatCalledOnEveryActor_Implementation() {}
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Only executed on Actor that is replicating</li>
<li>If you want to make sure RPC executed. you should set <code>Reliable</code> specifier on RPC&rsquo;s UFUNCTION().
<ul>
<li>RPC is Unreiiable by default.</li>
<li>If you spam <code>Reliable</code> like every ticks, client may get disconnected due to preventation of DDOS.</li>
</ul>
</li>
<li><code>WithValidation</code> specifier declares <code>_Validation</code> function with bool return and same parameters.
<ul>
<li><code>_Validation</code> function must be followed after <code>WithValidation</code> specifier.</li>
<li>disconnect client if return is <code>false</code></li>
<li>execute RPC if return is <code>true</code></li>
<li>Server RPC requires WithValidation</li>
</ul>
</li>
<li>when calling RPC on Server
<table>
<thead>
<tr>
<th>actor \ specifier</th>
<th>none</th>
<th><code>NetMulticast</code></th>
<th><code>Server</code></th>
<th><code>Client</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Owned by client</td>
<td>server</td>
<td>server & all clients</td>
<td>server</td>
<td>owning client</td>
</tr>
<tr>
<td>Owned by server</td>
<td>server</td>
<td>server & all clients</td>
<td>server</td>
<td>server</td>
</tr>
<tr>
<td>Unowned</td>
<td>server</td>
<td>server & all clients</td>
<td>server</td>
<td>server</td>
</tr>
</tbody>
</table>
</li>
<li>when calling RPC on Client
<table>
<thead>
<tr>
<th>actor \ specifier</th>
<th>none</th>
<th><code>NetMulticast</code></th>
<th><code>Server</code></th>
<th><code>Client</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Owned by self</td>
<td>self</td>
<td>self</td>
<td>server</td>
<td>self</td>
</tr>
<tr>
<td>Owned by other</td>
<td>self</td>
<td>self</td>
<td>none</td>
<td>self</td>
</tr>
<tr>
<td>Owned by server</td>
<td>self</td>
<td>self</td>
<td>none</td>
<td>self</td>
</tr>
<tr>
<td>Unowned</td>
<td>self</td>
<td>self</td>
<td>none</td>
<td>self</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2 id=component-replication><del>Component Replication</del><a hidden class=anchor aria-hidden=true href=#component-replication>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h1 id=optimization>Optimization<a hidden class=anchor aria-hidden=true href=#optimization>#</a></h1>
<h2 id=relevancy>Relevancy<a hidden class=anchor aria-hidden=true href=#relevancy>#</a></h2>
<ul>
<li><code>AActor::IsNetRelevantFor()</code>
<ol>
<li>return true : <code>bIsAlwaysRelevant</code> | Owned | Pawn | Instigated by Pawn</li>
<li>return owner&rsquo;s : <code>bNetUseOwnerRelevancy</code> & Owned</li>
<li>return false : <code>bOnlyRelevantToOwner</code> & not <strong>1.</strong></li>
<li>return base&rsquo;s : attached to skeleton of another actor</li>
<li>return false : <code>bHidden</code> & root component not collide
<ul>
<li>warning if there is no root component</li>
</ul>
</li>
<li>return ture : distance based relevancy (AGameNetworkManager) & closer than net cull distance</li>
</ol>
</li>
<li>Pawn and PlayerController return different result (overriding)</li>
<li>bStatic Actors can also be replicated</li>
<li>imperfect
<ul>
<li>large actor</li>
<li>sound occlusion of ambient sound</li>
<li>though, packet loss is more critical so it&rsquo;s affordable</li>
</ul>
</li>
</ul>
<h2 id=priority>Priority<a hidden class=anchor aria-hidden=true href=#priority>#</a></h2>
<ul>
<li><code>NetPriority</code></li>
<li>weight for bandwidth load balancing</li>
<li>default values
<ul>
<li>Actor = 1.0</li>
<li>Matinee = 2.7</li>
<li>Pawn = 3.0</li>
<li>PlayerController = 3.0</li>
</ul>
</li>
<li><code>AActor::GetNetPriority()</code> = <code>NetPriority</code> * replication waiting time (plus location and distance, etc)</li>
</ul>
<h2 id=dormancy>Dormancy<a hidden class=anchor aria-hidden=true href=#dormancy>#</a></h2>
<ul>
<li><code>ENetDormancy</code>
<ul>
<li><code>DORM_Never</code></li>
<li><code>DORM_Awake</code></li>
<li><code>DORM_DormantAll</code></li>
<li><code>DORM_DormantPartial</code> + <code>GetNetDormancy()</code></li>
<li><code>DORM_Initial</code></li>
<li><del><code>DORM_Max</code></del></li>
</ul>
</li>
</ul>
<h2 id=netclienttickspersecond><del>NetClientTicksPerSecond</del><a hidden class=anchor aria-hidden=true href=#netclienttickspersecond>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h2 id=replication-graph><del>Replication Graph</del><a hidden class=anchor aria-hidden=true href=#replication-graph>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h2 id=conceptual-tips>Conceptual Tips<a hidden class=anchor aria-hidden=true href=#conceptual-tips>#</a></h2>
<ul>
<li>reduce bReplicates</li>
<li>reduce NetUpdateFrequency</li>
<li>use Dormancy</li>
<li>use Relevancy</li>
<li>reduce NetClientTicksPerSecond</li>
<li>use Quantizing (e.g. FVector_NetQuantize)</li>
<li>minimize RPC : replace into RepNotify
<ul>
<li>remove Server RPC that unused on clients</li>
<li>reduce NetMulticast RPC</li>
<li>reduce FName as RPC parameter</li>
<li>don&rsquo;t spam reliable RPC</li>
</ul>
</li>
<li>check <code>ROLE_Authority</code> for server logic</li>
<li>check <code>IsLocallyControlled</code> for owner logic
<ul>
<li>but not in constructor</li>
</ul>
</li>
</ul>
<h1 id=flow>Flow<a hidden class=anchor aria-hidden=true href=#flow>#</a></h1>
<h2 id=unetdriverserverreplicateactors-flow><del>UNetDriver::ServerReplicateActors flow</del><a hidden class=anchor aria-hidden=true href=#unetdriverserverreplicateactors-flow>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h2 id=character-movement-component-flow><del>Character Movement Component flow</del><a hidden class=anchor aria-hidden=true href=#character-movement-component-flow>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h1 id=others>Others<a hidden class=anchor aria-hidden=true href=#others>#</a></h1>
<h2 id=travelling>Travelling<a hidden class=anchor aria-hidden=true href=#travelling>#</a></h2>
<ul>
<li>Seamless (non-blocking)
<ul>
<li>highly recommended</li>
</ul>
</li>
<li>Non-Seamless (blocking)
<ul>
<li>first map loading</li>
<li>client-to-server first connect</li>
<li>ending game, starting new game</li>
</ul>
</li>
<li><code>UEngine::Browse(...)</code></li>
<li><code>UWorld::ServerTravel(...)</code></li>
<li><code>APlayerController::ClientTravel(...)</code></li>
<li>Transition Map
<ul>
<li><code>UGameMapSetting::TransitionMap</code></li>
<li><code>AGameModeBase::bUseSeamlessTravel</code></li>
</ul>
</li>
<li>Seamless Travel Flow
<ol>
<li>Mark persistent actors to transition map</li>
<li>Travel to transition map</li>
<li>Mark persistent actors to final map</li>
<li>Travel to final map</li>
</ol>
</li>
<li>Persistent actors
<ul>
<li>GameMode actor (server only)
<ul>
<li>Actors added by <code>AGameModeBase::GetSeamlessTravelActorList</code></li>
</ul>
</li>
<li>Controllers with valid PlayerState (server only)</li>
<li>All PlayerControllers (server only)</li>
<li>All local PlayerControllers (server and clients)
<ul>
<li>Actors added by <code>APlayerController::GetSeamlessTravelActorList</code> on local</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id=online-subsystem><del>Online Subsystem</del><a hidden class=anchor aria-hidden=true href=#online-subsystem>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h2 id=session><del>Session</del><a hidden class=anchor aria-hidden=true href=#session>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h2 id=online-beacons><del>Online Beacons</del><a hidden class=anchor aria-hidden=true href=#online-beacons>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h1 id=practical>Practical<a hidden class=anchor aria-hidden=true href=#practical>#</a></h1>
<h2 id=network-profiler><del>Network Profiler</del><a hidden class=anchor aria-hidden=true href=#network-profiler>#</a></h2>
<ul>
<li>tbd</li>
</ul>
<h2 id=testing-multiplay><del>Testing Multiplay</del><a hidden class=anchor aria-hidden=true href=#testing-multiplay>#</a></h2>
<ul>
<li>tbd</li>
</ul>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=next href=https://niiok.github.io/unreal/sjoerddejong/kickstart_animation/>
<span class=title>Next Page »</span>
<br>
<span>Unreal Kickstart - Animation</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=https://niiok.github.io/>Niiok's Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>